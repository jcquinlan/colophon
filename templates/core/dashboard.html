{% extends 'base.html' %}

{% if not user.is_authenticated %}
    {% block banner %}
        <div class="top-banner">
            colofont is for finding and sharing book designs. Make an account, or read more about us.
        </div>
    {% endblock %}
{% endif %}

{% block content %}
    {% include 'partials/page-header.html' with page_title='Dashboard' paginator=documents %}

    <div class="columns">
        <div class="column"></div>
        <div class="column is-6">
            <div class="document-list">
                {% for document in documents %}
                    {% include 'partials/documents/document-card.html' %} 
                {% endfor %}
            </div>
        </div>
        <div class="column"></div>
    </div>

    {% include 'partials/page-footer.html' with page_title='Dashboard' paginator=documents %}
{% endblock %}

{% block scripts %}
<script>
    $('.carousel.carousel-slider').carousel({ fullWidth: true });

    // Add click listener for favoriting a document
    $('.favorite i').click(favoriteDocument);

    function favoriteDocument(event) {
        var target = $(event.target);
        var documentId = target.data('document-id');

        $.ajax({
            'url': BASEURL + '/document/' + documentId + '/favorite/',
            'type': 'POST',
            'success': onFavoriteSuccess,
            'error': onFavoriteError
        });

        function onFavoriteSuccess(res) {
            var iconClass = target.attr('class');
            var toastMessage = 'Document favorited.';

            if (iconClass === 'fas fa-heart') {
                target.attr('class', 'far fa-heart');
                toastMessage = 'Document unfavorited';
            } else {
                target.attr('class', 'fas fa-heart');
            }

            createToast(toastMessage);
        }

        function onFavoriteError(request, err) {
            console.error(err);
        }
    }

</script>
{% endblock %}